{% extends "base.html" %}

{% load i18n %}

{% block head_title %}
  {% trans "Partner Sign Up" %}
{% endblock head_title %}
{% block css %}
  <style>
    /* Make allauth form fields work with Bootstrap */
    .form-control {
      display: block;
      width: 100%;
      padding: 0.375rem 0.75rem;
      font-size: 1rem;
      font-weight: 400;
      line-height: 1.5;
      color: #212529;
      background-color: #fff;
      background-clip: padding-box;
      border: 1px solid #ced4da;
      border-radius: 0.375rem;
    }

    .form-control:focus {
      color: #212529;
      background-color: #fff;
      border-color: #86b7fe;
      outline: 0;
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    input[readonly] {
      background-color: #e9ecef;
    }
  </style>
{% endblock css %}
{% block content %}
  <div class="container">
    <div class="row justify-content-center mt-5">
      <div class="col-md-6 col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body p-4">
            <!-- Partner Info Header -->
            <div class="text-center mb-4">
              <h1 class="h3 mb-3">{% trans "Welcome to Loan Portal" %}</h1>
              {% if partner %}
                <div class="alert alert-info" role="alert">
                  <strong>{{ partner.company_name }}</strong>
                  <br />
                  <small>{{ partner.get_partner_type_display }} Partner</small>
                </div>
              {% endif %}
              <p class="text-muted">{% trans "Create your account to get started" %}</p>
            </div>
            <!-- Signup Form -->
            <form method="post"
                  action="{% url 'partners:partner_signup' token=partner.invite_token %}">
              {% csrf_token %}
              {% if form.errors %}
                <div class="alert alert-danger" role="alert">
                  <strong>{% trans "Please correct the errors below:" %}</strong>
                  {{ form.non_field_errors }}
                </div>
              {% endif %}
              <!-- Email Field (pre-filled, read-only) -->
              <div class="mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">
                  {% trans "Email" %} <span class="text-danger">*</span>
                </label>
                <input type="email"
                       name="{{ form.email.name }}"
                       value="{{ partner.email }}"
                       class="form-control {% if form.email.errors %}is-invalid{% endif %}"
                       id="{{ form.email.id_for_label }}"
                       readonly
                       required />
                {% if form.email.errors %}<div class="invalid-feedback">{{ form.email.errors }}</div>{% endif %}
                <small class="form-text text-muted">{% trans "This email is associated with your partner invitation." %}</small>
              </div>
              <!-- Password Field -->
              <div class="mb-3">
                <label for="{{ form.password1.id_for_label }}" class="form-label">
                  {% trans "Password" %} <span class="text-danger">*</span>
                </label>
                {{ form.password1 }}
                {% if form.password1.errors %}
                  <div class="invalid-feedback d-block">{{ form.password1.errors }}</div>
                {% else %}
                  <small class="form-text text-muted">{% trans "Your password must contain at least 8 characters." %}</small>
                {% endif %}
              </div>
              <!-- Password Confirmation -->
              <div class="mb-3">
                <label for="{{ form.password2.id_for_label }}" class="form-label">
                  {% trans "Password (again)" %} <span class="text-danger">*</span>
                </label>
                {{ form.password2 }}
                {% if form.password2.errors %}<div class="invalid-feedback d-block">{{ form.password2.errors }}</div>{% endif %}
              </div>
              <!-- Other allauth fields (if any) -->
              {% for field in form %}
                {% if field.name != 'email' and field.name != 'password1' and field.name != 'password2' %}
                  <div class="mb-3">
                    <label for="{{ field.id_for_label }}" class="form-label">
                      {{ field.label }}
                      {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                    </label>
                    {{ field }}
                    {% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors }}</div>{% endif %}
                    {% if field.help_text %}<small class="form-text text-muted">{{ field.help_text }}</small>{% endif %}
                  </div>
                {% endif %}
              {% endfor %}
              <!-- Submit Button -->
              <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-lg">{% trans "Create Account" %}</button>
              </div>
            </form>
            <!-- Footer -->
            <div class="text-center mt-4">
              <p class="text-muted small">
                {% trans "Already have an account?" %}
                <a href="{% url 'account_login' %}">{% trans "Sign in" %}</a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
